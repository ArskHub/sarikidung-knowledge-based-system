{% extends "base.html" %} {% block content %}
<header
  style="
    background: var(--dark);
    padding: 60px 0;
    text-align: center;
    color: white;
    border-bottom: 3px solid var(--gold);
  "
>
  <div class="animate-fade">
    <h1 style="font-family: 'Playfair Display', serif; color: var(--gold)">
      Expert System AI
    </h1>
    <p>
      Gunakan 5 parameter kriteria untuk mendapatkan akurasi identifikasi
      tertinggi.
    </p>
  </div>
</header>

<div class="container">
  <div
    class="grid-features"
    style="grid-template-columns: 1fr 1.2fr; gap: 40px; align-items: start"
  >
    <div class="glass-card animate-fade">
      <h3
        style="
          margin-bottom: 20px;
          border-bottom: 2px solid var(--gold);
          padding-bottom: 10px;
        "
      >
        Input Kriteria
      </h3>
      <form id="expertForm">
        <label>Jenis Yadnya</label>
        <select id="yadnya" required>
          <option value="" disabled selected>Pilih Yadnya...</option>
          {% for y in yadnyas %}
          <option value="{{ y }}">{{ y }}</option>
          {% endfor %}
        </select>

        <label>Nama Upacara</label>
        <select id="upacara" required>
          <option value="" disabled selected>Pilih Upacara...</option>
          {% for u in upacaras %}
          <option value="{{ u }}">{{ u }}</option>
          {% endfor %}
        </select>

        <label>Tahapan Upacara</label>
        <select id="tahap" required>
          <option value="" disabled selected>Pilih Tahapan...</option>
          {% for t in tahaps %}
          <option value="{{ t }}">{{ t }}</option>
          {% endfor %}
        </select>

        <label>Makna Kidung</label>
        <select id="makna" required>
          <option value="" disabled selected>Pilih Makna...</option>
          {% for m in maknas %}
          <option value="{{ m }}">{{ m }}</option>
          {% endfor %}
        </select>

        <label>Lokasi / Pura</label>
        <select id="pura" required>
          <option value="" disabled selected>Pilih Lokasi...</option>
          {% for p in puras %}
          <option value="{{ p }}">{{ p }}</option>
          {% endfor %}
        </select>

        <button
          type="submit"
          class="btn-predict"
          id="btnSubmit"
          style="margin-top: 30px"
        >
          <span id="btnText">JALANKAN ANALISIS AI</span>
        </button>
      </form>
    </div>

    <div id="display-area">
      <div
        id="welcome-msg"
        class="glass-card"
        style="
          text-align: center;
          padding: 100px 20px;
          border: 2px dashed var(--gold);
          opacity: 0.5;
        "
      >
        <p>
          Silakan isi kriteria di samping untuk melihat hasil identifikasi
          pakar.
        </p>
      </div>

      <div
        id="result-box"
        class="glass-card"
        style="
          display: none;
          border: 2px solid var(--gold);
          position: sticky;
          top: 100px;
        "
      >
        <div
          style="
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 1px double var(--gold);
            padding-bottom: 20px;
          "
        >
          <h5
            style="
              color: var(--gold);
              letter-spacing: 3px;
              font-size: 0.75rem;
              font-weight: 700;
            "
          >
            HASIL IDENTIFIKASI SISTEM PAKAR
          </h5>
          <h2
            id="resJudul"
            style="
              font-family: 'Playfair Display';
              font-size: 2.4rem;
              color: var(--dark);
              margin-top: 10px;
            "
          ></h2>
        </div>

        <div style="margin-bottom: 30px">
          <p
            style="
              font-size: 0.8rem;
              font-weight: 600;
              color: var(--gray-text);
              margin-bottom: 15px;
              text-transform: uppercase;
            "
          >
            Dasar Pertimbangan Sistem:
          </p>
          <div
            id="logic-path"
            style="display: flex; flex-wrap: wrap; gap: 10px"
          ></div>
        </div>

        <div
          style="
            background: #fffcf5;
            padding: 30px;
            border-radius: 5px;
            border: 1px solid rgba(212, 175, 55, 0.2);
            margin-bottom: 25px;
            position: relative;
          "
        >
          <span
            style="
              position: absolute;
              top: 10px;
              right: 20px;
              font-family: 'Playfair Display';
              color: rgba(212, 175, 55, 0.2);
              font-size: 4rem;
            "
            >â€œ</span
          >
          <h4
            style="
              font-family: 'Playfair Display';
              margin-bottom: 15px;
              color: var(--dark-light);
            "
          >
            Teks Suci / Lirik:
          </h4>
          <div
            id="resTeks"
            style="
              font-style: italic;
              white-space: pre-line;
              line-height: 2.2;
              color: #222;
              font-size: 1.1rem;
              text-align: center;
            "
          ></div>
        </div>

        <div
          style="
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
            background: var(--dark);
            color: var(--gold);
            border-radius: 8px;
          "
        >
          <div class="info-item">
            <small
              style="
                color: rgba(255, 255, 255, 0.5);
                display: block;
                margin-bottom: 5px;
              "
              >Kategori Bahasa</small
            >
            <span
              id="resBahasa"
              style="font-weight: 600; font-size: 1rem"
            ></span>
          </div>
          <div class="info-item">
            <small
              style="
                color: rgba(255, 255, 255, 0.5);
                display: block;
                margin-bottom: 5px;
              "
              >Validasi Makna</small
            >
            <span
              id="resKeterangan"
              style="font-weight: 600; font-size: 1rem"
            ></span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document
    .getElementById("expertForm")
    .addEventListener("submit", async function (e) {
      e.preventDefault();

      const btnText = document.getElementById("btnText");
      const resultBox = document.getElementById("result-box");
      const welcomeMsg = document.getElementById("welcome-msg");
      const logicContainer = document.getElementById("logic-path");

      btnText.innerText = "SEDANG MENGANALISIS...";

      // 1. Ambil data dari form
      const payload = {
        yadnya: document.getElementById("yadnya").value,
        upacara: document.getElementById("upacara").value,
        tahap: document.getElementById("tahap").value,
        makna: document.getElementById("makna").value,
        pura: document.getElementById("pura").value,
      };

      try {
        // 2. Kirim ke Flask
        const response = await fetch("/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        const data = await response.json();

        if (data.status === "success") {
          welcomeMsg.style.display = "none";
          resultBox.style.display = "block";

          // 3. Update Data Hasil
          document.getElementById("resJudul").innerText = data.judul;
          document.getElementById("resTeks").innerText = data.teks;
          document.getElementById("resBahasa").innerText = data.bahasa;
          document.getElementById("resKeterangan").innerText = data.keterangan;

          // 4. Update Jejak Logika (Decision Trace)
          logicContainer.innerHTML = "";
          const criteria = [
            { label: "Yadnya", val: payload.yadnya },
            { label: "Tahap", val: payload.tahap },
            { label: "Makna", val: payload.makna },
          ];

          criteria.forEach((item) => {
            const span = document.createElement("span");
            span.style =
              "background: #eee; padding: 5px 12px; border-radius: 4px; font-size: 0.75rem; border: 1px solid #ccc; color: #555;";
            span.innerHTML = `<strong>${item.label}:</strong> ${item.val}`;
            logicContainer.appendChild(span);
          });

          // Scroll otomatis ke hasil
          resultBox.scrollIntoView({ behavior: "smooth", block: "center" });
        } else {
          alert("Maaf: " + data.message);
        }
      } catch (err) {
        console.error(err);
        alert("Gagal menghubungi server Python.");
      } finally {
        btnText.innerText = "JALANKAN ANALISIS AI";
      }
    });
</script>
{% endblock %}
